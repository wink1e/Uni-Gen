# Uni-MOl用于重元素团簇结构生成

清华大学 李斌 欧阳健

## 1、背景介绍
我们课题组主要关注重元素化学性质的计算模拟，尤其关注重稀土元素（如U，Th等）的化学性质。而重稀土元素是一系列具有特殊电子结构和独特化学性质的元素，对于许多关键技术和应用领域至关重要，如磁性材料、光电材料、催化剂、能源存储等。
在我们自己的课题组研究过程中受限于重稀土元素放射性导致的实验数据的缺乏，和重元素相对论效应和强电子相关效应的导致理论计算模拟的困难。本次比赛我们关注一类稳定的重稀土元素化合物—重元素团簇，尤以铀酰团簇最为丰富多样。这类团簇化合物相近稳定结构多，第一性原理计算模拟需要合理初猜。亟待高效、稳定、准确的计算模拟研究的手段。
由于团簇的势能面十分复杂，搜索团簇结构是一件很困难的事情。我们希望基于Uni-Mol的通用分子表示能力，构建一个团簇合理结构的生成网络，用于合理团簇结构的生成。

## 2、模型介绍

通过学习Uni-Mol的基本结构和学习源代码，我们了解到Uni-Mol在进行预训练时是一个encoder-only的结构，联系到gpt等生成式语言模型基本很多基于encoder-decoder结构。我们类比构建了一个Uni-Mol的生成式模型，通过一个稳定结构的prompt和一个待优化的低合理度结构作为输入，输出一个高合理度的结构。模型的结构示意图具体见ppt：我们通过prompt经过Uni-Mol得到K，V和距离矩阵表示并将其输入到decoder中，将decoder中的待优化结构优化为合理结构作为输出。

## 3、训练集
* 根据模型的原理，训练集分为两个部分：prompt参考结构训练集和target临时结构训练集；
* 我们希望训练集的铀酰团簇结构种类丰富、结构数量充足，因此我们通过如下步骤生成训练集：
    1. **查阅文献采集了16种稳定铀酰团簇结构。**这些团簇组成不同，或者拓扑结构不同。这些团簇涉及到的元素包含：U、O、H、C、Li、Na、K，包括铀酰二聚体、四聚体、五聚体、六聚体、二十聚体、六十聚体（富勒烯结构），配体涉及O2-、OH-、C2O4 2-或者H2O；
    2. **利用cp2k软件跑AIMD轨迹。**采集到的稳定铀酰团簇结构用作AIMD的初始结构，在298K温度下跑250fs，每0.5fs记录一个数据点，每一条AIMD轨迹有500个数据点，一共有16条轨迹。每一条轨迹等间隔地选取**50**个结构加入target临时结构训练集，每一条轨迹选取能量最小的结构数据点复制为50个相同结构加入prompt参考结构训练集；
* **我们生成的target临时结构训练集和prompt参考结构训练集各包含4000个数据点**，分别保存在data_target_train.pkl和data_prompt_train.pkl文件中。

## 4、包结构
使用
```
pip install requirement.txt 
```
即可安装所有依赖库。并可按照以下提示使用模型。

我们将整个程序分解为三部分：1、数据集生成[prepare_data.py](./prepare_data.py)。2、训练模型[train.py](./train.py)。3、测试模型[test.py](./test.py)

通过命令行‘-h’查看各文件使用具体参数的帮助，即可方便地使用命令行运行模型。

## 5、简要分工

李斌：选题的构思，模型撰写，数据集扰动算法和差异度算法设计。
欧阳健：训练代码编写，数据集收集。

## 6、附录
本节简要介绍ppt内未详细介绍的算法详情：
* 结构扰动算法：
初始化阶段计算分子质心位置和各原子的配位数：
质心位置： 通过各元素的相对原子质量计算质心位置，并按照质心从内向外的顺序进行随机扰动。
配位数： 计算公式为
$$
c_i  = \sum_j s_0 \frac{1}{1+(\frac{r_{ij}}{r_0})^6} -s_0
$$
默认值为$s_0=500, r_0 = 0.5 \AA $
同时可以初始化将分子分解为不同的组，扰动中将具有相同的变化。可以指定最小配位数，使得配位数在最小配位数以上的原子不进行扰动。可以指定常量位置，这些位置将强行不移动。
考虑到团簇结构一般具有球状对称性，我们将扰动限定为质心到原子的向量所在法平面以外的区域，使得不会生成多个原子堆集在分子内部的情况。同时默认限定移动的原子数为25%到50%（可指定）
至此，我们认为这种扰动方式更符合化学直觉，同时会有更好的训练效果。

* 差异度计算算法：
我们首先构造分子中各原子的邻域距离矩阵，并通过共价半径的方式建立原子类型的映射。并借助主成分分析的想法，对实对称的邻域距离矩阵进行特征值分解，并只保留最大特征值和特征向量。可以证明这种做法保证的差异描述的旋转、平移置换不变性。同时大大加速了差异度的计算，对大体系的团簇更加合理。具体的细节可见ppt和源代码。

## 7、模型文件下载
由于模型文件较大，我们提供下载路径：
[预览链接](https://cloud.tsinghua.edu.cn/f/27384b7b89f642e8b6ec/)
[下载链接](https://cloud.tsinghua.edu.cn/f/27384b7b89f642e8b6ec/?dl=1)